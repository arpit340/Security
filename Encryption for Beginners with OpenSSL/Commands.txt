https://opensource.com/article/21/4/encryption-decryption-openssl

For PDF of cmds -
https://cheatography.com/albertx/cheat-sheets/openssl/


openssl list -help
openssl list -public-key-algorithm

echo "I am the text for encryption" > test.txt

For encryption using AES 
openssl enc -aes-256-cbc -in test.txt -out message.txt.enc

For decryption
openssl enc -aes-256-cbc -d -in message.txt.enc -> prompt for pwd
openssl enc -aes-256-cbc -d -in message.txt.enc -pass pass:1234

1. Create a sample file

   echo "This is my secret message" > message.txt

2. Encrypt a file

   openssl enc -aes-256-cbc -in message.txt -out message.txt.enc

3. Decrypt a file
   
  openssl enc -aes-256-cbc -d -in message.txt.enc -pass pass:example


PEM or Privacy Enhanced Mail is a Base64 encoded DER certificate.  PEM certificates are frequently used for web servers as they can easily be translated into readable data using a simple text editor.  Generally when a PEM encoded file is opened in a text editor, it contains very distinct headers and footers.

--------------------------------------------------------------------------------------------------------------------------

Create Asymmetric RSA keys:

1.genertae private key

	openssl genrsa -out myprivate1.pem 256
 
	openssl genrsa -out myprivate1.pem 1024

use any no of bits as industry standards, by default takes 2048 bits

2. Public key is extracted from private key

	openssl rsa -in myprivate1.pem -outform PEM -pubout -out mypublickey1.pem

spit the file in PEM form -pubout -> public key out  -out -> write to some file
if you don't use -pubout, then private key will be outputted

check with diff cmd
	diff myprivate1.pem mypublickey2.pem

3. To dispaly the key, all attributes etc. -> Information of the key
	openssl rsa -in myprivate1.pem -text
	openssl rsa -in mypublickey1.pem -pubin -text -noout

4. Encrypting Private key with encryption with passphrase

	openssl rsa -in myprivate1.pem -des3 -out myprivatekey1_enc.pem 
ask for passphrase

In Single Step --
	openssl genrsa -aes128 -out privatekey2_enc.pem

**By default takes 2048 bits

Generate the public key for the same - 
	openssl rsa -in privatekey2_enc.pem -outform PEM -pubout -out publickey2.pem
Prompts for the same passphrase used for encryption

------------------------------------------------------------------------------------------------------------------

Send a encrypted file -

1. Create keys for user1
	openssl genrsa -aes128 -out privatekey_user1.pem
	openssl rsa -in privatekey_user1.pem -outform PEM -pubout -out publickey_user1.pem

2. Create keys for user2
	openssl genrsa -aes128 -out privatekey_user2.pem
	openssl rsa -in privatekey_user2.pem -outform PEM -pubout -out publickey_user2.pem

3. Create a random Symmetric key
;	openssl rand -hex -out user1_random_key.bin 64

4. Encrypting the file using the above key
	openssl enc -aes-256-cbc -in confidential.txt -out confidencial.txt.enc -pass file:user1_random_key.bin

5. Encrypting the symmetric key with User2 public key
	openssl rsautl -encrypt -inkey publickey_user2.pem -pubin -in user1_random_key.bin -out user1_random_key.bin.enc

6. Decrypt the symmetric key with User2 private key
	openssl rsautl -decrypt -inkey privatekey_user2.pem -in user1_random_key.bin.enc -out user1_random_key.bin


7. Decrypt the document sent with the above extracted symmetric key
	openssl enc -d -aes-256-cbc -in confidencial.txt.enc -out confidencial.txt -pass file:user1_random_key.bin

****WE encrypt the key only with the User2 public key as when the data is larger, so key length should be very big 

---------------------------------------------------------------------------------------------------------------------------

Hashing
 in linux - Ubuntu -- Can use git bash on windows for sha256sum

1. Hashing a string in console
	echo "hello world" | cksum

2. Hashing a file
	 echo "This is my secret message" > message.txt
	 cksum message.txt
	
	cksum message.txt > message.txt.cksum

3. Hashing multiple files - ***Could be used to check the hashes for configuration files on server-
   Save these hashes and then later can be checked if these hashes match or not

	md5sum test* > md5hashes.txt

stored hashes in md5hashes.txt

O/p - 5e97c3c5f1356349d1d119c31162e685  test.txt
      7fa5186a5c17c98fa8fe02ef399a7be6  test1.txt

4. Check the hashes of multiple files and check if they are changed as well

	md5sum -c  md5hashes.txt
	
O/P - test.txt: OK
      test1.txt: OK

**if the files are changed run again 
	
	md5sum -c  md5hashes.txt

O/p-	test.txt: FAILED
	test1.txt: OK

example - md5sum etc/password

5. Checking s/w or files when downloaded from internet -
	sha256sum httpd2.4.0

Compare the SHA value when stored in a file
	sha256sum -c httpd2.4.0

-------------------------------------------------------------------------------------------------------------------------------------

Signing a document using openssl (rsautl)

File -> Hash -> Encrypted Hash (Signature)

[File & Signature & user's public key] -> send to user

1. 1. Create keys for user1
	openssl genrsa -aes128 -out privatekey_user1.pem
	openssl rsa -in privatekey_user1.pem -outform PEM -pubout -out publickey_user1.pem

2. Create keys for user2 - No need in signing process
	

3. Create a hash for the file to be signed using openssl instead of md5checksum or sh256checksum
	openssl dgst -sha256 documenttosign.txt > documenttosign.txt.sha256

4. Encrypting the hash with User1 private key
	openssl rsautl -sign -inkey privatekey_user1.pem -keyform PEM -in documenttosign.txt.sha256 -out documenttosign.txt.sha256.sign

-keyform PEM is optional

Verification Process

[File & Signature] -> [Signature] -> Hash (B)

	|
	|
[File] -> Hash (A)

5. Verification at user2 end
	openssl rsautl -verify -inkey publickey_user1.pem -pubin -keyform PEM -in documenttosign.txt.sha256.sign > hash_from_signature.txt

Can use sha256sum to check the hashes ---  Can use git bash on windows for sha256sum
	sha256sum -c hash_from_signature.txt

Another command for windows
	certutil -hashfile documenttosign.txt SHA256


----------------------------------------------------------------------------------------------------------------------------------------------

Signing a document using openssl (dgst)

1. Create keys for User1

2. Create a digtal signed document

	openssl dgst -sha256 -sign privatekey_user1.pem -out documenttosign.txt.sha256.sign.dgst documenttosign.txt

3. Verification of the document
	openssl dgst -sha256 -verify publickey_user1.pem -signature documenttosign.txt.sha256.sign.dgst documenttosign.txt

O/p- Verified Ok


 



											













